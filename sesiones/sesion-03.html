<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sesi√≥n 3: Escribir un perfil personal | Producci√≥n Escrita C2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>
    <header class="header">
        <div class="header-top">
            <div class="container">
                <span>Centro de Lenguas Modernas - Universidad de Granada</span>
                <div class="header-top-links">
                    <a href="../recursos/index.html">Recursos</a>
                    <a href="../calendario.html">Calendario</a>
                </div>
            </div>
        </div>
        <div class="header-main">
            <div class="container">
                <a href="../index.html" class="logo">
                    <div class="logo-icon">C2</div>
                    <div class="logo-text">
                        <span class="logo-title">Producci√≥n Escrita</span>
                        <span class="logo-subtitle">CLM - Universidad de Granada</span>
                    </div>
                </a>
                <nav class="nav-main" id="nav-main">
                    <a href="../index.html">Inicio</a>
                    <a href="index.html" class="active">Sesiones</a>
                    <a href="../temas/index.html">Temas</a>
                    <a href="../talleres/index.html">Talleres</a>
                </nav>
                <div class="nav-auth"></div>
                <button class="menu-toggle" id="menu-toggle"><span></span><span></span><span></span></button>
            </div>
        </div>
    </header>

    <main class="section">
        <div class="container">
            <div class="page-with-sidebar">
                <aside class="sidebar">
                    <div class="sidebar-section">
                        <h4 class="sidebar-title">Navegaci√≥n</h4>
                        <ul class="sidebar-nav">
                            <li><a href="#objetivos">Objetivos</a></li>
                            <li><a href="#contenidos">Contenidos</a></li>
                            <li><a href="#actividades">Actividades</a></li>
                            <li><a href="#tarea">Tarea</a></li>
                        </ul>
                    </div>
                    <div class="sidebar-section">
                        <h4 class="sidebar-title">Sesiones</h4>
                        <ul class="sidebar-nav">
                            <li><a href="sesion-02.html">Sesi√≥n 2</a></li>
                            <li><a href="sesion-03.html" class="active">Sesi√≥n 3</a></li>
                            <li><a href="sesion-04.html">Sesi√≥n 4</a></li>
                            <li><a href="index.html">Ver todas</a></li>
                        </ul>
                    </div>
                    <div class="sidebar-section">
                        <a href="/contacto.html" class="btn btn-outline btn-block btn-sm">
                            Contactar al profesor
                        </a>
                    </div>
                </aside>

                <div class="main-content">
                    <div class="card mb-4" style="background: linear-gradient(135deg, var(--primary-color), var(--primary-light)); color: white;">
                        <div class="card-body">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 1rem;">
                                <div>
                                    <span class="badge" style="background: rgba(255,255,255,0.2);">Sesi√≥n 3 de 27</span>
                                    <h1 style="color: white; margin: 0.5rem 0;">Escribir un perfil personal</h1>
                                    <p style="opacity: 0.9; margin: 0;">Martes, 10 de febrero de 2026 | 90 minutos</p>
                                </div>
                                <div style="display: flex; gap: 0.5rem;">
                                    <a href="sesion-02.html" class="btn btn-outline-white">&larr; Anterior</a>
                                    <a href="sesion-04.html" class="btn btn-outline-white">Siguiente &rarr;</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <section id="objetivos" class="card mb-4">
                        <div class="card-header">
                            <h2 style="margin: 0;">Objetivos de la sesi√≥n</h2>
                        </div>
                        <div class="card-body">
                            <ul>
                                <li>Desarrollar habilidades de producci√≥n escrita en el contexto de Escribir un perfil personal</li>
                                <li>Practicar estructuras y vocabulario espec√≠fico del tema</li>
                                <li>Analizar textos modelo y aplicar estrategias aprendidas</li>
                                <li>Producir textos propios con retroalimentaci√≥n</li>
                            </ul>
                        </div>
                    </section>

                    <section id="contenidos" class="card mb-4">
                        <div class="card-header">
                            <h2 style="margin: 0;">Contenidos</h2>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <strong>Contenido principal:</strong> Escribir un perfil personal</div>
                            <h4>Programaci√≥n de aula (90 minutos)</h4>
                            <table>
                                <thead>
                                    <tr><th>Tiempo</th><th>Actividad</th><th>Din√°mica</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>0-15 min</td><td>Calentamiento y activaci√≥n</td><td>Grupo clase</td></tr>
                                    <tr><td>15-35 min</td><td>An√°lisis de textos modelo</td><td>Parejas</td></tr>
                                    <tr><td>35-55 min</td><td>Pr√°ctica guiada</td><td>Individual</td></tr>
                                    <tr><td>55-80 min</td><td>Producci√≥n escrita</td><td>Individual</td></tr>
                                    <tr><td>80-90 min</td><td>Puesta en com√∫n y cierre</td><td>Grupo clase</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <section id="actividades">
                        
                    <!-- Actividad 1: Calentamiento -->
                    <section class="activity mb-4">
                        <div class="activity-header">
                            <span class="activity-type">Actividad 1 | Calentamiento</span>
                            <h3 class="activity-title">Activaci√≥n de conocimientos previos</h3>
                        </div>
                        <div class="activity-body">
                            <div class="activity-instructions">
                                <p><strong>Instrucciones:</strong> Responde a las siguientes preguntas sobre Escribir un perfil personal.</p>
                            </div>
                            <div id="quiz-activacion"></div>
                        </div>
                    </section>

                    <!-- Actividad 2: An√°lisis de modelo -->
                    <section class="activity mb-4">
                        <div class="activity-header">
                            <span class="activity-type">Actividad 2 | An√°lisis</span>
                            <h3 class="activity-title">An√°lisis de textos modelo</h3>
                        </div>
                        <div class="activity-body">
                            <div class="activity-instructions">
                                <p><strong>Instrucciones:</strong> Lee el siguiente texto y analiza sus caracter√≠sticas.</p>
                            </div>
                            <div class="card" style="background: var(--bg-light);">
                                <div class="card-body">
                                    <p><strong>Texto modelo disponible:</strong> Desc√°rgalo y analiza su estructura, registro, conectores utilizados y recursos ling√º√≠sticos destacados.</p>
                                    <a class="btn btn-outline btn-sm" href="../recursos/materiales/texto-modelo-sesion-03-perfil-personal.pdf" download>Descargar texto modelo (PDF)</a>
                                </div>
                            </div>
                            <div class="form-group mt-3">
                                <label class="form-label">Notas de an√°lisis:</label>
                                <textarea class="form-control" rows="4" placeholder="Escribe aqu√≠ tus observaciones sobre el texto..."></textarea>
                            </div>
                        </div>
                    </section>

                    <!-- An√°lisis del profesor (enlace temporal solo para admin) -->
                    <section class="activity mb-4" id="analisis-profesor">
                        <div class="activity-header">
                            <span class="activity-type">An√°lisis del profesor</span>
                            <h3 class="activity-title">An√°lisis del texto modelo</h3>
                        </div>
                        <div class="activity-body">
                            <!-- Contenido para estudiantes -->
                            <div id="estudiante-content" class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                <div class="card-body">
                                    <p style="margin: 0 0 1rem 0;"><strong>üîí An√°lisis del texto modelo</strong></p>
                                    <p style="margin: 0 0 1rem 0;">El profesor compartir√° el enlace de acceso durante la clase cuando corresponda.</p>
                                    <div class="form-group">
                                        <input type="text" id="enlace-estudiante" class="form-control" placeholder="El profesor te proporcionar√° un enlace aqu√≠..." readonly style="background: rgba(255,255,255,0.9); color: #333;">
                                    </div>
                                    <small style="opacity: 0.9;">Si tienes un enlace temporal del profesor, introd√∫celo arriba para acceder al an√°lisis.</small>
                                </div>
                            </div>

                            <!-- Contenido para admin -->
                            <div id="admin-content" style="display: none;">
                                <div class="card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                                    <div class="card-body">
                                        <h4 style="margin: 0 0 1rem 0;">üéì Panel del profesor</h4>
                                        <p style="margin: 0 0 1rem 0;">Genera un enlace temporal para que los estudiantes puedan acceder al an√°lisis.</p>

                                        <div class="form-group" style="max-width: 400px;">
                                            <label class="form-label" style="color: white;">Tiempo de expiraci√≥n:</label>
                                            <select id="expiry-time" class="form-control">
                                                <option value="30m">30 minutos</option>
                                                <option value="1h">1 hora</option>
                                                <option value="2h" selected>2 horas</option>
                                                <option value="4h">4 horas</option>
                                                <option value="24h">24 horas</option>
                                            </select>
                                        </div>

                                        <button type="button" class="btn btn-accent" onclick="generarEnlaceTemporal()">
                                            üìã Generar enlace temporal
                                        </button>

                                        <div id="enlace-generado" style="display: none; margin-top: 1.5rem;">
                                            <hr style="border-color: rgba(255,255,255,0.3); margin: 1rem 0;">
                                            <p style="margin: 0 0 0.5rem 0;"><strong>‚úÖ Enlace generado:</strong></p>
                                            <div class="form-group">
                                                <input type="text" id="temporal-link" class="form-control" readonly style="background: rgba(255,255,255,0.9); color: #333; font-size: 0.875rem;">
                                            </div>
                                            <button type="button" class="btn btn-outline-white btn-sm" onclick="copiarEnlace()">
                                                    üìã Copiar enlace
                                            </button>
                                            <a id="download-link" href="#" target="_blank" class="btn btn-outline-white btn-sm" style="margin-left: 0.5rem;">
                                                üì• Abrir enlace
                                            </a>
                                            <small style="display: block; margin-top: 0.5rem; opacity: 0.9;">
                                                ‚ö†Ô∏è Comparte este enlace con tus estudiantes. Expirar√° autom√°ticamente.
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Actividad 3: Pr√°ctica guiada -->
                    <section class="activity mb-4">
                        <div class="activity-header">
                            <span class="activity-type">Actividad 3 | Pr√°ctica</span>
                            <h3 class="activity-title">Ejercicios de Escribir un perfil personal</h3>
                        </div>
                        <div class="activity-body">
                            <div class="activity-instructions">
                                <p><strong>Instrucciones:</strong> Completa los siguientes ejercicios.</p>
                            </div>
                            <div id="fill-blanks-practice"></div>
                        </div>
                    </section>

                    <!-- Actividad 4: Producci√≥n escrita -->
                    <section class="activity mb-4">
                        <div class="activity-header">
                            <span class="activity-type">Actividad 4 | Producci√≥n</span>
                            <h3 class="activity-title">Redacci√≥n</h3>
                        </div>
                        <div class="activity-body">
                            <div class="activity-instructions">
                                <p><strong>Instrucciones:</strong> Escribe un texto siguiendo las pautas trabajadas en clase.</p>
                            </div>
                            <form data-submission-form data-session-id="3" data-activity-id="produccion" data-activity-title="Producci√≥n escrita - Sesi√≥n 3">
                                <div id="editor-produccion-3"></div>
                                <div class="mt-3" style="display: flex; justify-content: space-between; align-items: center;">
                                    <span class="text-secondary">Extensi√≥n recomendada: 150-250 palabras</span>
                                    <button type="submit" class="btn btn-primary">Enviar texto</button>
                                </div>
                            </form>
                        </div>
                    </section>
                    </section>

                    <section id="tarea" class="card mb-4" style="border: 2px solid var(--accent-color);">
                        <div class="card-header" style="background: var(--accent-color); color: var(--primary-dark);">
                            <h2 style="margin: 0; color: var(--primary-dark);">Tarea para casa</h2>
                        </div>
                        <div class="card-body">
                            <h4>Preparaci√≥n para la pr√≥xima sesi√≥n</h4>
                            <ol>
                                <li>Revisa y mejora el texto escrito en clase</li>
                                <li>Busca ejemplos adicionales de G√©neros textuales: el perfil</li>
                                <li>Prepara preguntas o dudas para la siguiente sesi√≥n</li>
                            </ol>
                            <form data-submission-form data-session-id="3" data-activity-id="tarea" data-activity-title="Tarea - Sesi√≥n 3">
                                <div class="form-group">
                                    <label class="form-label">Texto revisado o ejercicio adicional:</label>
                                    <textarea name="content" class="form-control" rows="5" placeholder="Escribe o pega aqu√≠ tu tarea..." required></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary">Enviar tarea</button>
                            </form>
                        </div>
                    </section>

                    <div style="display: flex; justify-content: space-between; margin-top: var(--spacing-xl);">
                        <a href="sesion-02.html" class="btn btn-outline">&larr; Sesi√≥n anterior</a>
                        <a href="sesion-04.html" class="btn btn-primary">Siguiente sesi√≥n &rarr;</a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom" style="border: none; padding-top: 0;">
                <span>&copy; 2026 Javier Ben√≠tez L√°inez | CLM - Universidad de Granada</span>
                <a href="/contacto.html" style="color: rgba(255,255,255,0.7);">Contacto</a>
            </div>
        </div>
    </footer>

    <script src="../js/config.js"></script>
<script src="../js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // Quiz de activaci√≥n
            PE.Activities.initQuiz('quiz-activacion', [
                {
                    question: '¬øQu√© es un perfil personal?',
                    options: ['Un texto que describe rasgos y experiencias de una persona', 'Una carta formal', 'Una noticia period√≠stica', 'Un texto acad√©mico'],
                    correct: 0
                },
                {
                    question: '¬øQu√© elementos deber√≠a incluir un perfil personal?',
                    options: ['La historia completa de la persona', 'Solo la informaci√≥n profesional', 'Datos personales, experiencias y rasgos caracter√≠sticos', 'Solo el nombre'],
                    correct: 2
                },
                {
                    question: '¬øQu√© tipo de registro es apropiado para un perfil personal?',
                    options: ['Muy formal y t√©cnico', 'Entre formal y semiformal, seg√∫n el contexto', 'Muy informal y coloquial', 'Solo jerga'],
                    correct: 1
                }
            ]);

            // Completar espacios
            PE.Activities.initFillBlanks('fill-blanks-practice',
                'Un perfil personal debe comenzar con una [1] que capte la atenci√≥n del lector. Es importante incluir datos sobre la [2] acad√©mica y profesional, as√≠ como los [3] e intereses que definen a la persona.',
                ['presentaci√≥n', 'trayectoria', 'hobbies']
            );

            // Editor de texto
            PE.TextEditor.init('editor-produccion-3');
        });
    </script>

    <!-- Script para gesti√≥n de enlaces temporales -->
    <script>
        // Nombre del archivo del an√°lisis
        const ANALISIS_FILENAME = 'analisis-sesion-03-perfil-personal.pdf';

        // Mostrar contenido seg√∫n el rol del usuario
        document.addEventListener('DOMContentLoaded', async function() {
            await mostrarContenidoSegunRol();
        });

        async function mostrarContenidoSegunRol() {
            try {
                // Verificar si hay usuario y si es admin
                const user = window.PE?.Auth?.getCurrentUser?.();

                if (user && user.role === 'admin') {
                    // Mostrar panel de admin
                    document.getElementById('estudiante-content').style.display = 'none';
                    document.getElementById('admin-content').style.display = 'block';
                } else {
                    // Mostrar contenido de estudiante
                    document.getElementById('estudiante-content').style.display = 'block';
                    document.getElementById('admin-content').style.display = 'none';
                }

                // Verificar si hay un enlace temporal en la URL
                const urlParams = new URLSearchParams(window.location.search);
                const recursoToken = urlParams.get('recurso');
                if (recursoToken) {
                    procesarEnlaceTemporal(recursoToken);
                }

            } catch (error) {
                console.error('Error verificando rol:', error);
                // Si hay error, mostrar contenido de estudiante por defecto
                document.getElementById('estudiante-content').style.display = 'block';
                document.getElementById('admin-content').style.display = 'none';
            }
        }

        // Generar enlace temporal (solo admin)
        async function generarEnlaceTemporal() {
            try {
                const expiryTime = document.getElementById('expiry-time').value;
                const user = window.PE?.Auth?.getCurrentUser?.();

                if (!user || user.role !== 'admin') {
                    alert('Solo el profesor puede generar enlaces temporales');
                    return;
                }

                const response = await window.PE?.API?.post('/recursos/temporal-link', {
                    filename: ANALISIS_FILENAME,
                    expiry: expiryTime
                });

                if (response && response.downloadLink) {
                    document.getElementById('enlace-generado').style.display = 'block';
                    document.getElementById('temporal-link').value = response.downloadLink;
                    document.getElementById('download-link').href = response.downloadLink;
                } else {
                    alert('Error al generar enlace temporal');
                }

            } catch (error) {
                console.error('Error generando enlace:', error);
                alert('Error al generar enlace temporal: ' + error.message);
            }
        }

        // Copiar enlace al portapapeles
        function copiarEnlace() {
            const linkInput = document.getElementById('temporal-link');
            linkInput.select();
            document.execCommand('copy');

            // Feedback visual
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úÖ Copiado';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        }

        // Procesar enlace temporal desde URL
        async function procesarEnlaceTemporal(token) {
            try {
                // Construir URL del recurso
                const baseUrl = window.PE?.CONFIG?.API_URL || window.location.origin;
                const downloadUrl = `${baseUrl}/api/recursos/download/${ANALISIS_FILENAME}?token=${token}`;

                // Mostrar en el campo del estudiante
                document.getElementById('enlace-estudiante').value = downloadUrl;

                // Crear bot√≥n de descarga
                const btn = document.createElement('button');
                btn.className = 'btn btn-accent btn-sm';
                btn.style.marginTop = '0.5rem';
                btn.textContent = 'üì• Descargar an√°lisis';
                btn.onclick = () => window.open(downloadUrl, '_blank');

                const container = document.getElementById('estudiante-content').querySelector('.card-body');
                container.appendChild(btn);

            } catch (error) {
                console.error('Error procesando enlace:', error);
            }
        }
    </script>
</body>
</html>
